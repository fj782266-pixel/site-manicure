<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendar Servi√ßo üíÖ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #ffe4f2, #f7b2d9);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.container {
    background: #fff;
    padding: 30px;
    border-radius: 15px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

h1 {
    text-align: center;
    margin-bottom: 25px;
    color: #d63384;
}

form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

label {
    font-size: 14px;
    font-weight: bold;
    color: #555;
}

input, select, button {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
    width: 100%;
}

button {
    background: #d63384;
    color: #fff;
    border: none;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
}

button:hover {
    background: #b62b6f;
}

ul {
    list-style: none;
    padding: 0;
    margin-top: 15px;
}
</style>

<!-- FIREBASE + FUN√á√ïES -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_AUTH_DOMAIN",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_STORAGE_BUCKET",
  messagingSenderId: "SEU_SENDER_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ======================
   SALVAR AGENDAMENTO
====================== */
window.salvarAgendamento = async function(event) {
    event.preventDefault();

    const nome = document.getElementById("nome").value;
    const telefone = document.getElementById("telefone").value;
    const endereco = document.getElementById("endereco").value;
    const servico = document.getElementById("servico").value;
    const data = document.getElementById("data").value;
    const hora = document.getElementById("hora").value;

    if (!nome || !telefone || !endereco || !servico || !data || !hora) {
        alert("‚ö†Ô∏è Preencha todos os campos");
        return;
    }

    // üö´ BLOQUEIA DATA + HORA REPETIDA
    const q = query(
        collection(db, "agendamentos"),
        where("data", "==", data),
        where("hora", "==", hora)
    );

    const snapshot = await getDocs(q);
    if (!snapshot.empty) {
        alert("‚ùå Esse hor√°rio j√° est√° ocupado!");
        return;
    }

    await addDoc(collection(db, "agendamentos"), {
        nome,
        telefone,
        endereco,
        servico,
        data,
        hora,
        criadoEm: new Date()
    });

    alert("‚úÖ Agendamento realizado com sucesso!");
    event.target.reset();
};

/* ======================
   LISTAR AGENDAMENTOS
====================== */
window.listarAgendamentos = async function () {
    const lista = document.getElementById("listaAgendamentos");
    lista.innerHTML = "Carregando...";

    const snapshot = await getDocs(collection(db, "agendamentos"));

    if (snapshot.empty) {
        lista.innerHTML = "<li>Nenhum agendamento encontrado</li>";
        return;
    }

    lista.innerHTML = "";

    snapshot.forEach(doc => {
        const a = doc.data();

        const item = document.createElement("li");
        item.style.marginBottom = "10px";
        item.style.borderBottom = "1px solid #ccc";
        item.style.paddingBottom = "8px";

        item.innerHTML = `
          <strong>${a.nome}</strong><br>
          üìû ${a.telefone}<br>
          üíÖ ${a.servico}<br>
          üìÖ ${a.data} ‚è∞ ${a.hora}
        `;

        lista.appendChild(item);
    });
};
</script>
</head>

<body>

<div class="container">
<h1>Agendar Servi√ßo üíÖ</h1>

<form onsubmit="salvarAgendamento(event)">
    <label>Nome</label>
    <input id="nome" type="text">

    <label>Telefone</label>
    <input id="telefone" type="tel">

    <label>Endere√ßo</label>
    <input id="endereco" type="text">

    <label>Servi√ßo</label>
    <select id="servico">
        <option value="">Selecione</option>
        <option>Manicure</option>
        <option>Pedicure</option>
        <option>Alongamento</option>
        <option>Manicure + Pedicure</option>
    </select>

    <label>Data</label>
    <input id="data" type="date">

    <label>Hora</label>
    <input id="hora" type="time">

    <button type="submit">Agendar</button>
</form>

<hr style="margin:20px 0">

<button onclick="listarAgendamentos()">
  Ver agendamentos üìã
</button>

<ul id="listaAgendamentos"></ul>

</div>

</body>
</html>
